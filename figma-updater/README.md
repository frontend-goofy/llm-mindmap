# figma-updater

`figma-updater` — это CLI-инструмент для синхронизации текстовых и графических изменений из макетов Figma с вашим репозиторием. Пакет объединяет удобство запроса версий из Figma, получения диффов через Eliza API и автоматического применения обновлений в кодовой базе.

## Возможности

- Просмотр списка версий файла Figma и связанных описаний.
- Получение текстовых и бинарных (изображения, иконки) различий между двумя версиями.
- Автоматическая замена текстовых фрагментов в исходниках с учётом include/exclude масок.
- Загрузка и обновление бинарных ассетов по путям, указанным в диффе.
- Поддержка режима предпросмотра (`--dry-run`) с отчётом о потенциальных изменениях.

## Установка

```bash
cd figma-updater
npm install
npm run build
```

CLI доступен через бинарь `figma-updater` после установки зависимостей или сборки.

## Конфигурация

Создайте файл `figma-updater.config.js` в корне проекта или укажите путь с помощью флага `--config`. Пример шаблона расположен в корне репозитория.

Главные параметры:

- `figma.apiToken` — персональный токен Figma.
- `elizaApi.baseUrl` и `elizaApi.apiKey` — настройки Eliza API, отдающего диффы.
- `project.rootDir` — корень локального проекта, в котором будет выполняться поиск файлов.
- `project.includeGlobs` / `project.excludeGlobs` — набор масок для поиска текстовых файлов.
- `project.assetRootDir` — (опционально) путь для сохранения бинарных ассетов относительно `rootDir`.

## Команды

```bash
figma-updater versions <fileKey>
figma-updater diff <fileKey> --from <versionA> --to <versionB>
figma-updater apply <fileKey> --from <versionA> --to <versionB> [--dry-run]
```

### versions
Показывает доступные версии файла Figma.

### diff
Отображает текстовые изменения и список бинарных ассетов, отличающихся между версиями.

### apply
Выполняет замену текста в найденных файлах и обновляет бинарные ассеты. При запуске без `--dry-run` изменения записываются на диск.

## Логирование

Инструмент использует структурированный логгер, поэтому удобно подключать вывод к CI или сохранять в файл. При необходимости включите `pino-pretty` для форматирования логов.

## Тестирование

```bash
npm test
```

Тесты покрывают применение текстовых диффов, обработку исключительных случаев и запись бинарных ассетов.

## Советы по интеграции

1. Настройте include/exclude маски так, чтобы CLI находил только релевантные файлы.
2. Используйте `--dry-run` перед каждым применением, чтобы убедиться, что изменения корректны.
3. Храните конфигурацию с чувствительными данными (токены) вне репозитория или передавайте их через переменные окружения.
